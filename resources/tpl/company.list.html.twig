{% extends 'base.default.html.twig' %}

{% block content %}

<h1><i class="icon-reorder"></i> Betriebsliste</h1>


<div class="row">
    <div class="span12">
        {% if app.request.get("success") %}
        <div class="alert alert-block alert-success">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <h4>Success!</h4>
            {% if app.request.get("deleted") %}
            Betrieb wurde erfolgreich gel&ouml;scht.
            {% endif %}

            {% if app.request.get("edited") %}
            Betrieb wurde erfolgreich editiert.
            {% endif %}
        </div>
        {% endif %}

        <table class="table table-hover" id="company-list">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Operationen</th>
                </tr>
            </thead>
            <tbody>
            {% for company in companies %}

                    <tr>
                        <td>{{ company.getId()|e }}</td>
                        <td>{{ company.getName()|e }}</td>
                        <td>
                            {% if is_granted('ROLE_WIRTSCHAFT_PRIV') %}
                            <button title="Details anzeigen" data-company="{{ company.getId() | e }}" class="btn btn-primary companyDetails"><i class="icon-reorder"></i></button>
                            {% endif %}

                            {% if is_granted('ROLE_WIRTSCHAFT_PRIV') %}
                            <a href="{{ url('edit_company',  { "id" : company.getId() } ) }}" title="Betrieb editieren" class="btn btn-success"><i class="icon-pencil"></i></a>
                            {% endif %}

                            {% if is_granted('ROLE_WIRTSCHAFT_ADMIN') %}
                            <a href="{{ url('delete_company',  { "id" : company.getId() } ) }}" title="Betrieb l&ouml;schen" class="btn btn-danger"><i class="icon-trash"></i></a>
                            {% endif %}
                        </td>
                    </tr>
            {% endfor %}
                </tbody>
        </table>
    </div>
</div>
<div id="companyInfo">

</div>

{% endblock %}


{% block header %}
<link href="{{ app.request.baseUrl }}/assets/dataTables/css/jquery.dataTables.css" type="text/css">
<link href="{{ app.request.baseUrl }}/assets/dataTables/css/dt.bootstrap.css" type="text/css">
{% endblock %}


{% block footer %}
    <script src="{{ app.request.baseUrl }}/assets/dataTables/js/jquery.dataTables.min.js"></script>
    <script src="{{ app.request.baseUrl }}/assets/dataTables/js/dt.bootstrap.js"></script>
    
    <script>
        $(document).ready(function(){
            $("a, button").tooltip( { "placement" : "bottom" });
           
            $("#company-list").dataTable ({
                sDom: "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
                "sPaginationType": "bootstrap"
            }); 
            
            $.extend( $.fn.dataTableExt.oStdClasses, {
                "sWrapper": "dataTables_wrapper form-inline"
            });
            
            $(".companyDetails").click(function(){
                var id = $(this).data("company");
                
                if($("#details" + id).length == 0)
                {
                    $.ajax({
                        url: "details/" + id,
                        type: "GET",
                        success: function(data) { 
                            $("#companyInfo").append(data);
                            showModal(id);
                            return;
                        }
                    });     
                }
                
                showModal(id);
            });
        });
        
        function showModal(id)
        {
            $("#details" + id).modal({show: true })
        }
        
    </script>
{% endblock %}